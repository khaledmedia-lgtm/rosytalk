<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cs.jo Portal</title>
    <style>
        :root { --blue: #007bff; --bg: #0f172a; --card: #1e293b; }
        body { font-family: sans-serif; background: var(--bg); color: white; padding: 15px; text-align: center; }
        .main-card { background: var(--card); padding: 20px; border-radius: 20px; max-width: 400px; margin: auto; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #334155; background: #020617; color: white; font-size: 18px; box-sizing: border-box; text-align: center; }
        button { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--blue); color: white; font-weight: bold; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:active { transform: scale(0.98); opacity: 0.8; }
        .result { margin-top: 20px; padding: 15px; border-radius: 12px; background: #020617; border-right: 5px solid var(--blue); display: none; text-align: right; }
        .status { font-size: 12px; color: #64748b; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="main-card">
        <h2 style="color: var(--blue);">Cs.jo Management</h2>
        <p>فحص صلاحية المشتركين</p>
        
        <input type="text" id="cardInput" placeholder="أدخل رقم البطاقة (مثلاً 7042391)">
        <button onclick="checkCard()">فحص الآن</button>

        <div id="res" class="result"></div>
        <div id="debug" class="status">الحالة: جاهز</div>
    </div>

    <script>
        // الرابط الخاص بك - تأكد منه 100%
        const WORKER_URL = "https://rosytalk1.khaled-media.workers.dev/search";
        const SECRET_KEY = "Mawgif_Secret_2025";

        async function checkCard() {
            const card = document.getElementById('cardInput').value;
            const resDiv = document.getElementById('res');
            const debug = document.getElementById('debug');

            if(!card) { alert("يرجى إدخال رقم"); return; }

            resDiv.style.display = 'none';
            debug.innerText = "جاري الاتصال بالسيرفر...";

            try {
                const url = `${WORKER_URL}?q=${card}`;
                console.log("Requesting:", url);

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Custom-Auth': SECRET_KEY,
                        'Content-Type': 'application/json'
                    }
                });

                debug.innerText = `استجابة السيرفر: ${response.status}`;

                if (!response.ok) throw new Error(`سيرفر Cloudflare أعطى خطأ ${response.status}`);

                const data = await response.json();

                if(data && data.length > 0) {
                    const person = data[0];
                    resDiv.innerHTML = `
                        <b style="color:var(--blue)">✅ البيانات موجودة:</b><br>
                        <b>الاسم:</b> ${person.first_name} ${person.last_name}<br>
                        <b>الشركة:</b> ${person.name}<br>
                        <b>رقم البطاقة:</b> ${person.car_plate}<br>
                        <b>تاريخ الانتهاء:</b> ${person.expiry_date}
                    `;
                    resDiv.style.display = 'block';
                    debug.innerText = "تم جلب البيانات بنجاح.";
                } else {
                    resDiv.innerHTML = "<b style='color:#ef4444'>⚠️ هذا الرقم غير مسجل في النظام.</b>";
                    resDiv.style.display = 'block';
                    debug.innerText = "البحث انتهى: لا توجد نتائج.";
                }

            } catch (err) {
                console.error(err);
                resDiv.innerHTML = `<b style='color:#ef4444'>❌ عطل في الاتصال:</b><br><small>${err.message}</small>`;
                resDiv.style.display = 'block';
                debug.innerText = "الحالة: فشل الاتصال.";
            }
        }
    </script>
</body>
</html>
